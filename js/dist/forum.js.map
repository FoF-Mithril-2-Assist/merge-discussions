{"version":3,"sources":["webpack://@fof/merge-discussions/webpack/bootstrap","webpack://@fof/merge-discussions/./forum.js","webpack://@fof/merge-discussions/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@fof/merge-discussions/./src/forum/components/DiscussionMergeModal.js","webpack://@fof/merge-discussions/./src/forum/components/DiscussionMergePost.js","webpack://@fof/merge-discussions/./src/forum/components/DiscussionSearch.js","webpack://@fof/merge-discussions/./src/forum/components/DiscussionSearchSource.js","webpack://@fof/merge-discussions/./src/forum/index.js","webpack://@fof/merge-discussions/external \"flarum.core.compat['components/Button']\"","webpack://@fof/merge-discussions/external \"flarum.core.compat['components/EventPost']\"","webpack://@fof/merge-discussions/external \"flarum.core.compat['components/Modal']\"","webpack://@fof/merge-discussions/external \"flarum.core.compat['components/Search']\"","webpack://@fof/merge-discussions/external \"flarum.core.compat['extend']\"","webpack://@fof/merge-discussions/external \"flarum.core.compat['helpers/highlight']\"","webpack://@fof/merge-discussions/external \"flarum.core.compat['utils/DiscussionControls']\"","webpack://@fof/merge-discussions/external \"flarum.core.compat['utils/ItemList']\""],"names":["DiscussionMergeModal","discussion","first","init","query","m","prop","results","title","app","translator","trans","content","DiscussionSearch","component","onSelect","select","bind","ignore","id","second","Button","className","type","onclick","submit","loading","disabled","children","e","preventDefault","request","url","forum","attribute","method","data","ids","errorHandler","onerror","then","res","console","log","Modal","DiscussionMergePost","icon","descriptionKey","descriptionData","props","post","EventPost","view","hasFocus","vdom","attrs","replace","sourceItems","items","ItemList","add","DiscussionSearchSource","Search","search","toLowerCase","params","filter","q","page","limit","store","find","d","map","highlight","initializers","postComponents","discussionMerged","extend","DiscussionControls","modal","show"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./forum.js\");\n","export * from './src/forum';\n","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","import Button from 'flarum/components/Button';\nimport Modal from 'flarum/components/Modal';\nimport DiscussionSearch from \"./DiscussionSearch\";\n\nexport default class DiscussionMergeModal extends Modal {\n    constructor(discussion) {\n        super();\n\n        this.first = discussion;\n    }\n\n    init() {\n        super.init();\n\n        this.query = m.prop('');\n        this.results = [];\n    }\n\n    title() {\n        return app.translator.trans('fof-merge-discussions.forum.modal.title');\n    }\n\n    content() {\n        return (\n            <div className=\"Modal-body\">\n                <div className=\"Form Form--centered\">\n                    <div className=\"Form-group\">\n                        {DiscussionSearch.component({\n                            onSelect: this.select.bind(this),\n                            ignore: this.first.id(),\n                        })}\n                    </div>\n                    <div className=\"Form-group\">\n                        <p>\n                            Merge <b>{this.first.title()}</b> into <b>{this.second && this.second.title() || '??'}</b>\n                        </p>\n                        {Button.component({\n                            className: 'Button Button--primary Button--block',\n                            type: 'submit',\n                            onclick: this.submit.bind(this),\n                            loading: this.loading,\n                            disabled: !this.first || !this.second,\n                            children: app.translator.trans('fof-merge-discussions.forum.modal.submit_button')\n                        })}\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n    select(discussion) {\n        if (discussion && discussion.id() === this.first.id()) return;\n\n        this.second = discussion;\n    }\n\n    submit(e) {\n        e.preventDefault();\n\n        this.loading = true;\n\n        return app.request({\n            url: `${app.forum.attribute('apiUrl')}/discussions/merge`,\n            method: 'POST',\n            data: {\n                ids: [this.first.id(), this.second.id()]\n            },\n            errorHandler: this.onerror.bind(this)\n        }).then(res => {\n            console.log(res);\n        })\n    }\n}\n","import EventPost from 'flarum/components/EventPost';\n\nexport default class DiscussionMergePost extends EventPost {\n    /**\n     * Get the name of the event icon.\n     *\n     * @return {String}\n     */\n    icon() {\n        return 'fas fa-code-branch fa-flip-vertical';\n    }\n\n    /**\n     * Get the translation key for the description of the event.\n     *\n     * @return {String}\n     */\n    descriptionKey() {\n        return 'fof-merge-discussions.forum.post.merged';\n    }\n\n    /**\n     * Get the translation data for the description of the event.\n     *\n     * @return {Object}\n     */\n    descriptionData() {\n        return this.props.post.content();\n    }\n}\n","import Search from 'flarum/components/Search';\nimport ItemList from 'flarum/utils/ItemList';\nimport DiscussionSearchSource from \"./DiscussionSearchSource\";\n\nexport default class DiscussionSearch extends Search {\n    view() {\n        this.hasFocus = true;\n\n        const vdom = super.view();\n\n        vdom.attrs.className = 'MergeDiscussions-Search open ' + vdom.attrs.className.replace(/(focused|open)/g, '');\n\n        return vdom;\n    }\n\n    sourceItems() {\n        const items = new ItemList();\n\n        items.add('discussions', new DiscussionSearchSource(this.props.onSelect, this.props.ignore));\n\n        return items;\n    }\n}","import highlight from 'flarum/helpers/highlight';\n\nexport default class DiscussionSearchSource {\n    constructor(onSelect, ignore) {\n        this.results = {};\n\n        this.onSelect = onSelect;\n        this.ignore = ignore;\n    }\n\n    search(query) {\n        query = query.toLowerCase();\n\n        this.results[query] = [];\n\n        const params = {\n            filter: {q: query},\n            page: {limit: 3},\n        };\n\n        return app.store.find('discussions', params).then(results => {\n            this.results[query] = results.filter(d => d.id() !== this.ignore);\n        });\n    }\n\n    view(query) {\n        query = query.toLowerCase();\n\n        const results = this.results[query] || [];\n\n        return [\n            results.map(discussion => {\n                return (\n                    <li className=\"DiscussionSearchResult\" data-index={'discussions' + discussion.id()}>\n                        <a onclick={() => this.onSelect(discussion)}>\n                            <div className=\"DiscussionSearchResult-title\">{highlight(discussion.title(), query)}</div>\n                        </a>\n                    </li>\n                );\n            })\n        ];\n    }\n}","import { extend } from 'flarum/extend';\nimport DiscussionControls from 'flarum/utils/DiscussionControls';\nimport Button from 'flarum/components/Button';\n\nimport DiscussionMergeModal from './components/DiscussionMergeModal';\nimport DiscussionMergePost from './components/DiscussionMergePost';\n\napp.initializers.add('fof/merge-discussions', () => {\n    // app.models.discussions.prototype.canMerge = Model.attribute('canMerge');\n\n    app.postComponents.discussionMerged = DiscussionMergePost;\n\n    extend(DiscussionControls, 'moderationControls', function(items, discussion) {\n        // if (!discussion.canMerge()) return;\n\n        items.add(\n            'fof-merge',\n            Button.component({\n                icon: 'fas fa-code-branch fa-flip-vertical',\n                children: app.translator.trans('fof-merge-discussions.forum.discussion.merge'),\n                onclick: () => app.modal.show(new DiscussionMergeModal(discussion)),\n            })\n        );\n    });\n});\n","module.exports = flarum.core.compat['components/Button'];","module.exports = flarum.core.compat['components/EventPost'];","module.exports = flarum.core.compat['components/Modal'];","module.exports = flarum.core.compat['components/Search'];","module.exports = flarum.core.compat['extend'];","module.exports = flarum.core.compat['helpers/highlight'];","module.exports = flarum.core.compat['utils/DiscussionControls'];","module.exports = flarum.core.compat['utils/ItemList'];"],"sourceRoot":""}