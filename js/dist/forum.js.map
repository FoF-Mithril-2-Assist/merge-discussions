{"version":3,"sources":["webpack://@fof/merge-discussions/webpack/bootstrap","webpack://@fof/merge-discussions/./forum.js","webpack://@fof/merge-discussions/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@fof/merge-discussions/./src/forum/components/DiscussionMergeModal.js","webpack://@fof/merge-discussions/./src/forum/components/DiscussionMergePost.js","webpack://@fof/merge-discussions/./src/forum/components/DiscussionSearch.js","webpack://@fof/merge-discussions/./src/forum/components/DiscussionSearchSource.js","webpack://@fof/merge-discussions/./src/forum/index.js","webpack://@fof/merge-discussions/external \"flarum.core.compat['components/Button']\"","webpack://@fof/merge-discussions/external \"flarum.core.compat['components/EventPost']\"","webpack://@fof/merge-discussions/external \"flarum.core.compat['components/Modal']\"","webpack://@fof/merge-discussions/external \"flarum.core.compat['components/Search']\"","webpack://@fof/merge-discussions/external \"flarum.core.compat['extend']\"","webpack://@fof/merge-discussions/external \"flarum.core.compat['helpers/highlight']\"","webpack://@fof/merge-discussions/external \"flarum.core.compat['helpers/punctuateSeries']\"","webpack://@fof/merge-discussions/external \"flarum.core.compat['utils/DiscussionControls']\"","webpack://@fof/merge-discussions/external \"flarum.core.compat['utils/ItemList']\""],"names":["DiscussionMergeModal","discussion","merging","init","query","m","prop","results","title","app","translator","trans","content","DiscussionSearch","component","onSelect","select","bind","ignore","id","selected","map","d","Button","className","type","onclick","submit","loading","disabled","length","children","includes","push","e","preventDefault","request","url","forum","attribute","method","data","ids","errorHandler","onerror","then","res","console","log","Modal","DiscussionMergePost","icon","descriptionKey","descriptionData","props","post","titles","Array","isArray","punctuateSeries","EventPost","view","hasFocus","vdom","attrs","replace","sourceItems","items","ItemList","add","DiscussionSearchSource","Search","search","toLowerCase","params","filter","q","page","limit","store","find","highlight","initializers","postComponents","discussionMerged","extend","DiscussionControls","modal","show"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./forum.js\");\n","export * from './src/forum';\n","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","import Button from 'flarum/components/Button';\nimport Modal from 'flarum/components/Modal';\n\nimport DiscussionSearch from \"./DiscussionSearch\";\n\nexport default class DiscussionMergeModal extends Modal {\n    constructor(discussion) {\n        super();\n\n        this.discussion = discussion;\n        this.merging = [];\n    }\n\n    init() {\n        super.init();\n\n        this.query = m.prop('');\n        this.results = [];\n    }\n\n    title() {\n        return app.translator.trans('fof-merge-discussions.forum.modal.title');\n    }\n\n    content() {\n        return (\n            <div className=\"Modal-body\">\n                <div className=\"Form Form--centered\">\n                    <div className=\"Form-group\">\n                        {DiscussionSearch.component({\n                            onSelect: this.select.bind(this),\n                            ignore: this.discussion.id(),\n                            selected: this.merging.map(d => d.id())\n                        })}\n                    </div>\n                    <div className=\"Form-group\">\n                        <p style=\"text-align: left;\">\n                            <ul>\n                                {this.merging.map(d =>\n                                    <li>{d.title()}</li>\n                                )}\n                            </ul>\n                        </p>\n                    </div>\n                    <div className=\"Form-group\">\n                        {Button.component({\n                            className: 'Button Button--primary Button--block',\n                            type: 'submit',\n                            onclick: this.submit.bind(this),\n                            loading: this.loading,\n                            disabled: !this.discussion || !this.merging.length,\n                            children: app.translator.trans('fof-merge-discussions.forum.modal.submit_button')\n                        })}\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n    select(discussion) {\n        if (discussion && discussion.id() === this.discussion.id()) return;\n\n        if (!this.merging.includes(discussion)) this.merging.push(discussion);\n    }\n\n    submit(e) {\n        e.preventDefault();\n\n        this.loading = true;\n\n        return app.request({\n            url: `${app.forum.attribute('apiUrl')}/discussions/${this.discussion.id()}/merge`,\n            method: 'POST',\n            data: {\n                ids: this.merging.map(d => d.id())\n            },\n            errorHandler: this.onerror.bind(this)\n        }).then(res => {\n            console.log(res);\n        })\n    }\n}\n","import EventPost from 'flarum/components/EventPost';\nimport punctuateSeries from 'flarum/helpers/punctuateSeries';\n\nexport default class DiscussionMergePost extends EventPost {\n    /**\n     * Get the name of the event icon.\n     *\n     * @return {String}\n     */\n    icon() {\n        return 'fas fa-code-branch fa-flip-vertical';\n    }\n\n    /**\n     * Get the translation key for the description of the event.\n     *\n     * @return {String}\n     */\n    descriptionKey() {\n        return 'fof-merge-discussions.forum.post.merged';\n    }\n\n    /**\n     * Get the translation data for the description of the event.\n     *\n     * @return {Object}\n     */\n    descriptionData() {\n        const data = this.props.post.content();\n\n        console.log(data.titles);\n\n        if (Array.isArray(data.titles)) data.titles = punctuateSeries(data.titles);\n\n        return data;\n    }\n}\n","import Search from 'flarum/components/Search';\nimport ItemList from 'flarum/utils/ItemList';\nimport DiscussionSearchSource from \"./DiscussionSearchSource\";\n\nexport default class DiscussionSearch extends Search {\n    view() {\n        this.hasFocus = true;\n\n        const vdom = super.view();\n\n        vdom.attrs.className = 'MergeDiscussions-Search open ' + vdom.attrs.className.replace(/(focused|open)/g, '');\n\n        return vdom;\n    }\n\n    sourceItems() {\n        const items = new ItemList();\n\n        items.add('discussions', new DiscussionSearchSource(this.props.onSelect, this.props.ignore));\n\n        return items;\n    }\n}","import highlight from 'flarum/helpers/highlight';\n\nexport default class DiscussionSearchSource {\n    constructor(onSelect, ignore) {\n        this.results = {};\n\n        this.onSelect = onSelect;\n        this.ignore = ignore;\n    }\n\n    search(query) {\n        query = query.toLowerCase();\n\n        this.results[query] = [];\n\n        const params = {\n            filter: {q: query},\n            page: {limit: 3},\n        };\n\n        return app.store.find('discussions', params).then(results => {\n            this.results[query] = results.filter(d => d.id() !== this.ignore);\n        });\n    }\n\n    view(query) {\n        query = query.toLowerCase();\n\n        const results = this.results[query] || [];\n\n        return [\n            results.map(discussion => {\n                return (\n                    <li className=\"DiscussionSearchResult\" data-index={'discussions' + discussion.id()}>\n                        <a onclick={() => this.onSelect(discussion)}>\n                            <div className=\"DiscussionSearchResult-title\">{highlight(discussion.title(), query)}</div>\n                        </a>\n                    </li>\n                );\n            })\n        ];\n    }\n}","import { extend } from 'flarum/extend';\nimport DiscussionControls from 'flarum/utils/DiscussionControls';\nimport Button from 'flarum/components/Button';\n\nimport DiscussionMergeModal from './components/DiscussionMergeModal';\nimport DiscussionMergePost from './components/DiscussionMergePost';\n\napp.initializers.add('fof/merge-discussions', () => {\n    // app.models.discussions.prototype.canMerge = Model.attribute('canMerge');\n\n    app.postComponents.discussionMerged = DiscussionMergePost;\n\n    extend(DiscussionControls, 'moderationControls', function(items, discussion) {\n        // if (!discussion.canMerge()) return;\n\n        items.add(\n            'fof-merge',\n            Button.component({\n                icon: 'fas fa-code-branch fa-flip-vertical',\n                children: app.translator.trans('fof-merge-discussions.forum.discussion.merge'),\n                onclick: () => app.modal.show(new DiscussionMergeModal(discussion)),\n            })\n        );\n    });\n});\n","module.exports = flarum.core.compat['components/Button'];","module.exports = flarum.core.compat['components/EventPost'];","module.exports = flarum.core.compat['components/Modal'];","module.exports = flarum.core.compat['components/Search'];","module.exports = flarum.core.compat['extend'];","module.exports = flarum.core.compat['helpers/highlight'];","module.exports = flarum.core.compat['helpers/punctuateSeries'];","module.exports = flarum.core.compat['utils/DiscussionControls'];","module.exports = flarum.core.compat['utils/ItemList'];"],"sourceRoot":""}